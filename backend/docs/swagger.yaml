definitions:
  handlers.StudentHandler:
    properties:
      accountSvc:
        $ref: '#/definitions/services.IdentityService'
      studentSvc:
        $ref: '#/definitions/services.StudentService'
    type: object
  handlers.UpdateStatusInput:
    properties:
      status:
        enum:
        - accepted
        - rejected
        - pending
        type: string
    required:
    - status
    type: object
  handlers.oauthToken:
    properties:
      code:
        type: string
    type: object
  model.Audit:
    properties:
      action:
        type: string
      actorID:
        type: string
      createdAt:
        type: string
      id:
        type: integer
      objectID:
        type: string
      objectName:
        type: string
      reason:
        type: string
    type: object
  model.File:
    properties:
      category:
        $ref: '#/definitions/model.FileCategory'
      createdAt:
        type: string
      id:
        type: string
      updatedAt:
        type: string
      userId:
        type: string
    type: object
  model.FileCategory:
    enum:
    - image
    - document
    type: string
    x-enum-varnames:
    - FileCategoryImage
    - FileCategoryDocument
  model.MailLog:
    properties:
      body:
        type: string
      createdAt:
        type: string
      errorCode:
        type: string
      errorDesc:
        type: string
      id:
        type: integer
      retryCount:
        description: Number of retry attempts made
        type: integer
      status:
        $ref: '#/definitions/model.MailLogStatus'
      subject:
        type: string
      to:
        type: string
      updatedAt:
        type: string
    type: object
  model.MailLogStatus:
    enum:
    - delivered
    - temporary_error
    - permanent_error
    type: string
    x-enum-varnames:
    - MailLogStatusDelivered
    - MailLogStatusTemporaryError
    - MailLogStatusPermanentError
  model.StudentApprovalStatus:
    enum:
    - accepted
    - rejected
    - pending
    type: string
    x-enum-varnames:
    - StudentApprovalAccepted
    - StudentApprovalRejected
    - StudentApprovalPending
  repository.ApplicationWithJobDetails:
    properties:
      companyName:
        type: string
      createdAt:
        description: Base application fields
        type: string
      email:
        type: string
      experience:
        type: string
      files:
        description: Attached files for the application (if loaded by the repository
          implementation)
        items:
          $ref: '#/definitions/model.File'
        type: array
      isOpen:
        type: boolean
      jobId:
        type: integer
      jobName:
        type: string
      jobType:
        type: string
      maxSalary:
        type: integer
      minSalary:
        type: integer
      phone:
        type: string
      photoId:
        type: string
      position:
        description: Denormalized job/company fields
        type: string
      status:
        type: string
      userId:
        type: string
    type: object
  repository.FullApplicantDetail:
    properties:
      aboutMe:
        type: string
      birthDate:
        type: string
      createdAt:
        description: Base application fields
        type: string
      email:
        type: string
      files:
        items:
          $ref: '#/definitions/model.File'
        type: array
      github:
        type: string
      jobId:
        type: integer
      linkedIn:
        type: string
      major:
        type: string
      phone:
        type: string
      photoId:
        type: string
      status:
        type: string
      studentId:
        type: string
      userId:
        type: string
      username:
        description: Applicant details
        type: string
    type: object
  repository.ShortApplicationDetail:
    properties:
      createdAt:
        description: Base application fields
        type: string
      email:
        type: string
      files:
        description: Attached files for the application (if loaded by the repository
          implementation)
        items:
          $ref: '#/definitions/model.File'
        type: array
      jobId:
        type: integer
      major:
        type: string
      phone:
        type: string
      status:
        type: string
      studentId:
        type: string
      userId:
        type: string
      username:
        description: Denormalized applicant fields
        type: string
    type: object
  repository.StudentProfile:
    properties:
      aboutMe:
        type: string
      approvalStatus:
        $ref: '#/definitions/model.StudentApprovalStatus'
      birthDate:
        format: date
        type: string
      createdAt:
        type: string
      email:
        type: string
      firstName:
        type: string
      fullName:
        type: string
      github:
        type: string
      id:
        type: string
      lastName:
        type: string
      linkedIn:
        type: string
      major:
        type: string
      phone:
        type: string
      photo:
        $ref: '#/definitions/model.File'
      photoId:
        type: string
      status:
        type: string
      statusFile:
        $ref: '#/definitions/model.File'
      statusFileId:
        type: string
      studentId:
        type: string
      updatedAt:
        type: string
    type: object
  services.CompanyResponse:
    properties:
      about:
        type: string
      address:
        type: string
      bannerId:
        type: string
      city:
        type: string
      country:
        type: string
      createdAt:
        type: string
      email:
        type: string
      name:
        type: string
      phone:
        type: string
      photoId:
        type: string
      userId:
        type: string
      website:
        type: string
    type: object
  services.IdentityService:
    type: object
  services.StudentService:
    type: object
info:
  contact: {}
paths:
  /admin/audits:
    get:
      description: Retrieves a list of all audit log entries. This endpoint is restricted
        to admin users.
      produces:
      - application/json
      responses:
        "200":
          description: List of all audit log entries
          schema:
            items:
              $ref: '#/definitions/model.Audit'
            type: array
        "403":
          description: Forbidden
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get an Audit Log (Admin only)
      tags:
      - Admin
  /admin/emaillog:
    get:
      description: Retrieves a list logs related to email i.e, sending success failure,
        to whom.
      produces:
      - application/json
      responses:
        "200":
          description: List of all audit log entries
          schema:
            items:
              $ref: '#/definitions/model.MailLog'
            type: array
        "403":
          description: Forbidden
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get log of email (Admin only)
      tags:
      - Admin
  /applications:
    get:
      description: Returns applications belonging to the authenticated user (company
        or student).
      parameters:
      - description: Status filter (pending|accepted|rejected)
        in: query
        name: status
        type: string
      - description: Sort (name|date-desc|date-asc)
        in: query
        name: sortBy
        type: string
      - description: Offset
        in: query
        name: offset
        type: integer
      - description: Limit (max 64)
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            properties:
              applications:
                items:
                  $ref: '#/definitions/repository.ApplicationWithJobDetails'
                type: array
              total:
                type: integer
            type: object
        "401":
          description: Unauthorized
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: List current user's applications
      tags:
      - Job Applications
  /auth/google/login:
    post:
      consumes:
      - application/json
      description: Handles the server-side flow for Google OAuth2. It receives an
        authorization code from the client, exchanges it for a token with Google,
        fetches the user's profile information, and then either creates a new user
        account or logs in an existing user. On success, it returns a JWT token and
        sets a refresh token cookie.
      parameters:
      - description: Google Authorization Code
        in: body
        name: code
        required: true
        schema:
          $ref: '#/definitions/handlers.oauthToken'
      produces:
      - application/json
      responses:
        "200":
          description: Login successful
          schema:
            properties:
              isRegistered:
                type: boolean
              role:
                type: string
              token:
                type: string
              userId:
                type: string
              username:
                type: string
            type: object
        "400":
          description: Bad Request
          schema:
            properties:
              error:
                type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      summary: Handle Google OAuth login
      tags:
      - Authentication
  /auth/logout:
    post:
      description: Invalidates the user's session by revoking both the JWT token (blacklist)
        and refresh token. Complies with OWASP session termination requirements.
      produces:
      - application/json
      responses:
        "200":
          description: Logged out successfully
          schema:
            properties:
              message:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Logout user
      tags:
      - Authentication
  /auth/refresh:
    post:
      description: Renews an access token using a valid refresh token provided in
        a cookie. It returns a new JWT and user details, and sets a new refresh token
        cookie.
      produces:
      - application/json
      responses:
        "200":
          description: Successfully refreshed token
          schema:
            properties:
              ' role':
                type: string
              ' userId':
                type: string
              ' username':
                type: string
              token:
                type: string
            type: object
        "401":
          description: 'Unauthorized: Missing, invalid, or expired refresh token'
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: 'Internal Server Error: Failed to generate new tokens'
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Refresh JWT token
      tags:
      - Authentication
  /auth/student/register:
    post:
      consumes:
      - multipart/form-data
      description: Handles the registration process for a user who has already authenticated
        (e.g., via Google OAuth) to become a student. The registration is submitted
        for admin approval. This endpoint is protected and requires authentication.
      parameters:
      - description: Phone number
        in: formData
        name: phone
        type: string
      - description: Birth date in RFC3339 format (e.g., 2006-01-02T15:04:05Z)
        in: formData
        name: birthDate
        type: string
      - description: A short bio or about me section
        in: formData
        name: aboutMe
        type: string
      - description: GitHub profile URL
        in: formData
        name: github
        type: string
      - description: LinkedIn profile URL
        in: formData
        name: linkedIn
        type: string
      - description: 10-digit student ID number
        in: formData
        name: studentId
        required: true
        type: string
      - description: Major of study
        enum:
        - Software and Knowledge Engineering
        - Computer Engineering
        in: formData
        name: major
        required: true
        type: string
      - description: Current student status
        enum:
        - Graduated
        - Current Student
        in: formData
        name: studentStatus
        required: true
        type: string
      - description: Profile photo
        in: formData
        name: photo
        required: true
        type: file
      - description: Document proving student status (e.g., student ID card photo)
        in: formData
        name: statusPhoto
        required: true
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: ok
          schema:
            properties:
              message:
                type: string
            type: object
        "400":
          description: Bad Request
          schema:
            properties:
              error:
                type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            properties:
              error:
                type: string
            type: object
        "409":
          description: 'Conflict: User already registered'
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Register as a student
      tags:
      - Students
  /company:
    get:
      description: Retrieves a list of all registered companies. This endpoint is
        restricted to admin users.
      produces:
      - application/json
      responses:
        "200":
          description: List of all companies
          schema:
            items:
              $ref: '#/definitions/services.CompanyResponse'
            type: array
        "403":
          description: Forbidden
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get a list of all companies (Admin only)
      tags:
      - Companies
  /company/{id}:
    get:
      description: Retrieves the profile of a specific company using their user ID.
      parameters:
      - description: Company User ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Company profile retrieved successfully
          schema:
            $ref: '#/definitions/services.CompanyResponse'
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get a company's profile
      tags:
      - Companies
  /files/{fileID}:
    get:
      description: Serves a file from the server's file system using its unique ID.
        This is a public endpoint.
      parameters:
      - description: File ID
        in: path
        name: fileID
        required: true
        type: string
      produces:
      - application/octet-stream
      responses:
        "200":
          description: The requested file
          schema:
            type: file
        "400":
          description: 'Bad Request: Invalid file identifier or path'
          schema:
            properties:
              error:
                type: string
            type: object
        "404":
          description: 'Not Found: File not found'
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      summary: Get a file
      tags:
      - Files
  /jobs/{id}/applications:
    delete:
      description: Deletes applications for a job filtered by status flags.
      parameters:
      - description: Job ID
        in: path
        name: id
        required: true
        type: integer
      - description: Include pending
        in: body
        name: pending
        schema:
          type: boolean
      - description: Include rejected
        in: body
        name: rejected
        schema:
          type: boolean
      - description: Include accepted
        in: body
        name: accepted
        schema:
          type: boolean
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            properties:
              message:
                type: string
            type: object
        "400":
          description: Bad Request
          schema:
            properties:
              error:
                type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Clear job applications
      tags:
      - Job Applications
    get:
      description: Returns applications for a specific job (authorization enforced
        in service layer).
      parameters:
      - description: Job ID
        in: path
        name: id
        required: true
        type: integer
      - description: Status filter (pending|accepted|rejected)
        in: query
        name: status
        type: string
      - description: Pagination offset
        in: query
        name: offset
        type: integer
      - description: Pagination limit (max 64)
        in: query
        name: limit
        type: integer
      - description: Sort (latest|oldest|name_az|name_za)
        in: query
        name: sortBy
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            items:
              $ref: '#/definitions/repository.ShortApplicationDetail'
            type: array
        "400":
          description: Bad Request
          schema:
            properties:
              error:
                type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: List applications for a job
      tags:
      - Job Applications
  /jobs/{id}/applications/{email}:
    get:
      description: Returns detailed application info for a student email on a job.
      parameters:
      - description: Job ID
        in: path
        name: id
        required: true
        type: integer
      - description: Student email
        in: path
        name: email
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/repository.FullApplicantDetail'
        "400":
          description: Bad Request
          schema:
            properties:
              error:
                type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            properties:
              error:
                type: string
            type: object
        "404":
          description: Not Found
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get a single job application
      tags:
      - Job Applications
  /jobs/{id}/applications/{studentUserId}:
    patch:
      consumes:
      - application/json
      description: Changes the status of a student's application for a job.
      parameters:
      - description: Job ID
        in: path
        name: id
        required: true
        type: integer
      - description: Student User ID
        in: path
        name: studentUserId
        required: true
        type: string
      - description: New status
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/handlers.UpdateStatusInput'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            properties:
              message:
                type: string
              status:
                type: string
            type: object
        "400":
          description: Bad Request
          schema:
            properties:
              error:
                type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Update application status
      tags:
      - Job Applications
  /jobs/{id}/apply:
    post:
      consumes:
      - multipart/form-data
      description: Submit a new application (approved student applying to an approved
        job). Files must include up to 2 documents.
      parameters:
      - description: Job ID
        in: path
        name: id
        required: true
        type: integer
      - description: Alternate phone number
        in: formData
        name: phone
        type: string
      - description: Alternate email address
        in: formData
        name: email
        type: string
      - description: Application files (max 2)
        in: formData
        name: files
        required: true
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            properties:
              message:
                type: string
            type: object
        "400":
          description: Invalid input
          schema:
            properties:
              error:
                type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Apply to a job
      tags:
      - Job Applications
  /me:
    get:
      description: Retrieves basic profile information (username, role, and user ID)
        for the currently authenticated user.
      produces:
      - application/json
      responses:
        "200":
          description: Successfully retrieved user profile
          schema:
            properties:
              ' role':
                type: string
              ' userId':
                type: string
              username:
                type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get current user's profile
      tags:
      - Users
    patch:
      consumes:
      - multipart/form-data
      description: Edits the profile of the currently authenticated user. This endpoint
        automatically detects whether the user is a student or a company and accepts
        the appropriate fields for that role. Supports partial updates.
      parameters:
      - description: Phone number (For both Student and Company)
        in: formData
        name: phone
        type: string
      - description: Birth date in RFC3339 format (Student only)
        in: formData
        name: birthDate
        type: string
      - description: About me/us section (For both Student and Company)
        in: formData
        name: aboutMe
        type: string
      - description: GitHub profile URL (Student only)
        in: formData
        name: github
        type: string
      - description: LinkedIn profile URL (Student only)
        in: formData
        name: linkedIn
        type: string
      - description: Student status (Student only)
        enum:
        - Graduated
        - Current Student
        in: formData
        name: studentStatus
        type: string
      - description: Company email (Company only)
        in: formData
        name: email
        type: string
      - description: Company website URL (Company only)
        in: formData
        name: website
        type: string
      - description: Company address (Company only)
        in: formData
        name: address
        type: string
      - description: Company city (Company only)
        in: formData
        name: city
        type: string
      - description: Company country (Company only)
        in: formData
        name: country
        type: string
      - description: Profile photo/logo (For both Student and Company)
        in: formData
        name: photo
        type: file
      - description: Company banner image (Company only)
        in: formData
        name: banner
        type: file
      produces:
      - application/json
      responses:
        "200":
          description: ok
          schema:
            properties:
              message:
                type: string
            type: object
        "400":
          description: Bad Request
          schema:
            properties:
              error:
                type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            properties:
              error:
                type: string
            type: object
        "403":
          description: Forbidden
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Edit user profile
      tags:
      - Users
  /me/deactivate:
    post:
      description: Soft deletes the user account. The account can be reactivated within
        the grace period (default 30 days, configurable via ACCOUNT_DELETION_GRACE_PERIOD_DAYS
        env variable). After the grace period expires, all personal data is automatically
        anonymized (not deleted) to comply with Thailand's PDPA while retaining data
        for analytics and compliance.
      produces:
      - application/json
      responses:
        "200":
          description: Account deactivated successfully
          schema:
            properties:
              deletion_date:
                type: string
              grace_period_days:
                type: integer
              message:
                type: string
            type: object
        "400":
          description: Account already deactivated
          schema:
            properties:
              error:
                type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            properties:
              error:
                type: string
            type: object
        "404":
          description: User not found
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal server error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Deactivate account
      tags:
      - Users
  /me/reactivate:
    post:
      description: Reactivates a deactivated account if within the grace period. Once
        the grace period expires and data is anonymized, reactivation is not possible.
        Requires valid authentication token.
      produces:
      - application/json
      responses:
        "200":
          description: Account reactivated successfully
          schema:
            properties:
              message:
                type: string
            type: object
        "400":
          description: Account is not deactivated
          schema:
            properties:
              error:
                type: string
            type: object
        "401":
          description: Unauthorized
          schema:
            properties:
              error:
                type: string
            type: object
        "403":
          description: Grace period expired, account already anonymized
          schema:
            properties:
              error:
                type: string
            type: object
        "404":
          description: User not found
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal server error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Reactivate account
      tags:
      - Users
  /students:
    get:
      description: Fetches student profile information. An admin can retrieve a paginated
        list of all students and filter by approval status. A regular user will get
        their own detailed profile. An admin can also specify a user ID to get a specific
        profile.
      parameters:
      - description: User ID of a specific student (for admins)
        in: query
        name: id
        type: string
      - description: Pagination offset (for admin list)
        in: query
        name: offset
        type: integer
      - default: 64
        description: Pagination limit (for admin list)
        in: query
        name: limit
        type: integer
      - description: Filter by approval status (for admin list)
        enum:
        - pending
        - accepted
        - rejected
        in: query
        name: approvalStatus
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: Returns a single student's detailed profile
          schema:
            properties:
              profile:
                $ref: '#/definitions/repository.StudentProfile'
            type: object
        "400":
          description: Bad Request
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Get student profile(s)
      tags:
      - Students
  /students/{id}/approval:
    post:
      consumes:
      - application/json
      description: Allows an admin to approve or reject a student's registration application
        based on their user ID.
      parameters:
      - description: User ID of the student to be approved/rejected
        in: path
        name: id
        required: true
        type: string
      - description: Approval action
        in: body
        name: approval
        required: true
        schema:
          $ref: '#/definitions/handlers.StudentHandler'
      produces:
      - application/json
      responses:
        "200":
          description: ok
          schema:
            properties:
              message:
                type: string
            type: object
        "400":
          description: Bad Request
          schema:
            properties:
              error:
                type: string
            type: object
        "404":
          description: 'Not Found: Student not found'
          schema:
            properties:
              error:
                type: string
            type: object
        "500":
          description: Internal Server Error
          schema:
            properties:
              error:
                type: string
            type: object
      security:
      - BearerAuth: []
      summary: Approve or reject a student registration (Admin only)
      tags:
      - Students
swagger: "2.0"
